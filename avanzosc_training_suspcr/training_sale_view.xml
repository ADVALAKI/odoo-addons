<?xml version="1.0" encoding="UTF-8"?>
<openerp>
	<data>
		<!-- 
		=========================================================== 
		SALE ORDER 
		===========================================================
		-->
		<!-- Sale order -->
		
		<record model="ir.ui.view" id="sale_order_training_tree_view">
			<field name="name">sale.order.training.tree</field>
			<field name="model">sale.order</field>
			<field name="type">tree</field>
			<field name="inherit_id" ref="sale.view_order_tree" />
			<field name="arch" type="xml">
				<xpath expr="//field[@name='user_id']" position="replace">
				</xpath>
				<xpath expr="//field[@name='client_order_ref']" position="replace">
				</xpath>
				<field name="partner_id" position="after">
					<field name="contact_id"/>
					<!-- <field name="student_insurance"/>
					<field name="insurance_type"/>
					<field name="contact_age"/> -->
					<field name="offer_id"/>
					<field name="session_id"/>
					<!-- <field name="sales"/> -->
					<!-- <field name="editions"/> -->
				</field>
			</field>
		</record>
		
		<record model="ir.ui.view" id="sale_order_training_tree_view2">
			<field name="name">sale.order.training.tree2</field>
			<field name="model">sale.order</field>
			<field name="type">tree</field>
			<field name="inherit_id" ref="sale_margin.sale_margin_sale_order_tree" />
			<field name="arch" type="xml">
				<xpath expr="//field[@name='margin']" position="replace">
				</xpath>
			</field>
		</record>
		
		<record model="ir.ui.view" id="sale_order_training_tree_view3">
			<field name="name">sale.order.training.tree3</field>
			<field name="model">sale.order</field>
			<field name="type">tree</field>
			<field name="inherit_id" ref="sale_journal.sale_journal_sale_order_tree" />
			<field name="arch" type="xml">
				<xpath expr="//field[@name='invoice_type_id']" position="replace">
				</xpath>
			</field>
		</record>
		
		<record model="ir.ui.view" id="sale_order_training_search_view">
			<field name="name">sale.order.training.search</field>
			<field name="model">sale.order</field>
			<field name="type">search</field>
			<field name="inherit_id" ref="sale.view_sales_order_filter" />
			<field name="arch" type="xml">
				<xpath expr="//field[@name='user_id']" position="replace">
					<field name="offer_id"/>
					<field name="session_id"/>
					<!-- <field name="sales"/> -->
					<!-- <field name="seance_id"/> -->
				</xpath>
				<xpath expr="//field[@name='session_id']" position="after">
					<newline/>
					<group expand="0" string="Filter By..." colspan="11" col="11" groups="base.group_extended">
						<filter string="New Students" domain="[('sales', '=', '1.00')]" />
						<filter string="Insurance" domain="[('student_insurance', '=',True)]" />
					</group>
				</xpath>
				<xpath expr="//filter[@string='Order Date']" position="after">
					<filter string="Student" domain="[]" context="{'group_by':'contact_id'}" />
					<filter string="Offer" domain="[]" context="{'group_by':'offer_id'}" />
					<filter string="Session" domain="[]" context="{'group_by':'session_id'}" />
				</xpath>
			</field>
		</record>
		
		<record model="ir.ui.view" id="sale_order_training_form_view">
			<field name="name">sale.order.training.form</field>
			<field name="model">sale.order</field>
			<field name="type">form</field>
			<field name="inherit_id" ref="sale.view_order_form" />
			<field name="arch" type="xml">
				<field name="partner_id" position="after">
					<field name="contact_id"/>
					<field name="student_insurance"/>
					<field name="insurance_type" attrs="{'invisible':[('student_insurance','!=',True)]}"/>
					<field name="recog" invisible="1"/>
				</field>
			</field>
		</record>

		<!-- FORM -->
		<record model="ir.ui.view" id="sale_order_form_view">
			<field name="name">sale.order.form.view</field>
			<field name="model">sale.order</field>
			<field name="inherit_id" ref="sale.view_order_form" />
			<field name="type">form</field>
			<field name="arch" type="xml">
				<xpath expr="//page [@string='Sales Order']" position="after">
					<page string="Discounts Information" attrs="{'invisible':[('recog','=',False)]}">
						<field name="discount_line_ids" nolabel="1" colspan="4"/>
					</page>
					<page string="Sessions">
						<group colspan="5" col="4">
							<separator string="Session(s)" colspan="4"/>
							<newline/>
							<field name="session_id" colspan="2"/>
							<field name="session_id2" attrs="{'required':[('super_title','=',True)]}"/>
							<newline/>
						</group>
					</page>
				</xpath>
				<xpath expr="//field[@name='shipped']" position="after">
					<field name="offer_id" colspan="4"/>
					<field name="super_title" invisible="1"/>
					<field name="act_par"/>
				</xpath>
				<xpath expr="//page[@string='Order Line']/field[@name='product_id']" position="before">
					<field name="seance_id" context="partner_id=parent.partner_id,quantity=product_uom_qty,pricelist=parent.pricelist_id,shop=parent.shop_id,uom=product_uom"
					on_change="onchange_seance_id(seance_id, parent.session_id, parent.contact_id, parent.pricelist_id,product_id,product_uom_qty,product_uom,product_uos_qty,product_uos,name,parent.partner_id, 'lang' in context and context['lang'], True, parent.date_order, product_packaging, parent.fiscal_position, False)"/>
					<field name="offer_id"/>
					<field name="tipology"/>
					<field name="call"/>
					<field name="check"/>
					<field name="teaching"/>
					<field name="matching"/>
					<!-- <field name="convalidate"/> -->
				</xpath>
				<xpath expr="//tree[@string='Sales Order Lines']/field[@name='name']" position="after">
					<field name="coursenum_id" readonly="1"/>
					<field name="offer_id" readonly="1"/>
					<field name="tipology" readonly="1"/>
					<field name="call" readonly="1"/>
					<field name="check"/>
					<field name="teaching" readonly="1"/>
					<field name="matching" readonly="1"/>
					<!-- <field name="convalidate"/> -->
				</xpath>
				<!-- <xpath expr="//field[@name='order_line']" position="attributes">
					<attribute name="on_change">onchange_lines()</attribute>
				</xpath> -->
				<xpath expr="//tree[@string='Sales Order Lines']" position="attributes">
					<attribute name="editable">"bottom"</attribute>
				</xpath>
				<!-- <xpath expr="//field[@name='order_line']" position="attributes">
					<attribute name="context">{'group_by':'call'}</attribute>
				</xpath> -->
			</field>
		</record>
		
		<!-- 
		=========================================================== 
		SALE ORDER LINE
		===========================================================
		-->
		<!-- Sale order line -->
		
		<!-- <record id="view_training_sales_order_line_filter" model="ir.ui.view">
            <field name="name">training.sale.order.line</field>
            <field name="model">sale.order.line</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Search Uninvoiced Lines">
                    <filter icon="terp-gtk-go-back-rtl" string="To Do"
                        domain="[('state','=','confirmed')]"
                        name="sale order"
                        help="Confirmed sale order lines, not yet delivered"
                        />
                    <filter icon="terp-dialog-close" string="Done"
                        domain="[('state','=','done')]"
                        name="sale_order_done"
                        help="Sale order lines done"
                        />
                    <separator orientation="vertical"/>
                    <filter icon="terp-accessories-archiver" string="Shipped"
                        domain="[('state','=','done')]"
                        name="unshipped"
                        help="Sale Order Lines that are in 'done' state"
                        />
                    <filter icon="terp-dolar_ok!" string="invoiced" name="invoiced"
                    	domain="[('invoiced','=', 1)]"
                        help="Sale Order Lines that are confirmed, done or in exception state and haven't yet been invoiced"
                        />
                    <separator orientation="vertical"/>
                    <field name="order_id"/>
                    <field name="order_partner_id"/>
                    <field name="product_id"/>
                    <field name="salesman_id">
                        <filter icon="terp-personal" domain="[('salesman_id','=',uid)]" help="My Sales Order Lines"/>
                    </field>
                    <newline />
                    <group expand="0" string="Group By..." colspan="9" col="8">
                        <filter string="Order" icon="terp-gtk-jump-to-rtl" domain="[]" context="{'group_by':'order_id'}" help="Order reference"/>
                        <filter string="Product" icon="terp-accessories-archiver" domain="[]" context="{'group_by':'product_id'}"/>
                        <separator orientation="vertical"/>
                        <filter string="State" icon="terp-stock_effects-object-colorize" domain="[]" context="{'group_by':'state'}"/>
                    </group>
                </search>
            </field>
        </record> -->
        
        <record id="view_order_line_training_search" model="ir.ui.view">
            <field name="name">sale.order.line.search</field>
            <field name="model">sale.order.line</field>
            <field name="inherit_id" ref="sale.view_sales_order_line_filter" />
            <field name="type">search</field>
            <field name="arch" type="xml">
            	<xpath expr="//field[@name='order_partner_id']" position="after">
            		<field name="contact_id"/>
            		<field name="offer_id"/>
            		<field name="session_id"/>
            	</xpath>
            	<xpath expr="//filter[@string='State']" position="after">
            		<filter string="Offer" domain="[]" context="{'group_by':'offer_id'}"/>
            		<filter string="Session" domain="[]" context="{'group_by':'session_id'}"/>
            		<filter string="Contact" domain="[]" context="{'group_by':'contact_id'}"/>
            	</xpath>
            </field>
        </record>
        
        <record id="view_order_line_training_tree2" model="ir.ui.view">
            <field name="name">sale.order.line.tree2</field>
            <field name="model">sale.order.line</field>
            <field name="inherit_id" ref="sale_margin.sale_margin_sale_order_line_tree" />
            <field name="type">tree</field>
            <field name="arch" type="xml">
            	<xpath expr="//field[@name='margin']" position="replace">
            	</xpath>
            	<xpath expr="//field[@name='price_subtotal']" position="replace">
            	</xpath>
            </field>
        </record>
        
        <record id="view_order_line_training_tree" model="ir.ui.view">
            <field name="name">sale.order.line.tree</field>
            <field name="model">sale.order.line</field>
            <field name="inherit_id" ref="sale.view_order_line_tree" />
            <field name="type">tree</field>
            <field name="arch" type="xml">
            	<xpath expr="//field[@name='order_id']" position="replace">
            	</xpath>
            	<xpath expr="//field[@name='order_partner_id']" position="replace">
            		<field name="contact_id"/>	
            		<field name="offer_id"/>
            		<field name="session_id"/>
            	</xpath>
            	<xpath expr="//field[@name='product_id']" position="after">
            		<field name="call"/>
            	</xpath>
            	<xpath expr="//field[@name='salesman_id']" position="replace">
            	</xpath>
            	<xpath expr="//field[@name='product_uom_qty']" position="replace">
            		<field name="product_uom_qty" string="Credits"/>
            	</xpath>
            	<xpath expr="//field[@name='product_uom']" position="replace">
            	</xpath>
            </field>
        </record>
        
        <!--
	===========================================================
	 	TRAINING DISCOUNT LINE
	===========================================================
	-->
	
	<!-- TREE -->

		<record model="ir.ui.view" id="training_discount_line_tree_view">
			<field name="name">training_discount_line</field>
			<field name="model">training.discount.line</field>
			<field name="type">tree</field>
			<field name="arch" type="xml">
				<tree string="Discount Lines">
					<field name="discount_type" />
					<field name="discount" />
					<field name="seance" />
					<field name="call" />
					<field name="quantity" />
					<field name="udm" />
					<field name="price_unit" />
					<field name="discount_qty" />
				</tree>
			</field>
		</record>
		
	<!-- FORM -->

		<record model="ir.ui.view" id="training_discount_line_form_view">
			<field name="name">training_discount_line</field>
			<field name="model">training.discount.line</field>
			<field name="type">form</field>
			<field name="arch" type="xml">
				<form string="Discount Line">
					<field name="discount_type" />
					<field name="discount" />
					<field name="seance" />
					<field name="call" />
					<field name="quantity" />
					<field name="udm" />
					<field name="price_unit" />
					<field name="discount_qty" />
				</form>
			</field>
		</record>
		
	<!-- SEARCH -->

		<record model="ir.ui.view" id="training_discount_line_search_view">
			<field name="name">training_discount_line</field>
			<field name="model">training.discount.line</field>
			<field name="type">search</field>
			<field name="arch" type="xml">
				<search string="Discount Lines">
					<field name="discount_type" />
					<field name="discount" />
					<field name="seance" />
					<field name="call" />
					<field name="quantity" />
					<field name="udm" />
					<field name="price_unit" />
					<field name="discount_qty" />
				</search>
			</field>
		</record>
		
		<record id="action_training_order_line_tree" model="ir.actions.act_window">
            <field name="name">Sale order lines</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">sale.order.line</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,graph</field>
            <!-- <field name="search_view_id" ref="view_training_sales_order_line_filter" /> -->
            <field name="search_view_id" ref="view_order_line_training_search" />
            <field name="filter" eval="True"/>
            <field name="help">Here is a list of each sales order line to be invoiced. You can invoice sales orders partially, by lines of sales order. You do not need this list if you invoice from the delivery orders or if you invoice sales totally.</field>
        </record>
        
        <!-- <menuitem id="menu_invoiced" name="Invoicing" parent="base.menu_base_partner" sequence="5"
            groups="base.group_extended"/> -->
            
        <menuitem action="action_training_order_line_tree" id="menu_training_sales_order_lines" parent="base.menu_sales" sequence="2" groups="base.group_sale_salesman,base.group_sale_manager"/>
		
	</data>
</openerp>